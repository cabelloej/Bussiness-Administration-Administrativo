SELECT 5
FIND &WNUMERO2
IF EOF()
   STORE "ERROR, DESAPARECIO EL DOCUMENTO "+WNUMERO2+" EN LA ACT. DE DOC. PROC." TO MES
ELSE
   IF REFERENCIA <> SPACE(23)
      STORE MONTO TO WMONTO
      STORE REFERENCIA TO WREFX
      FIND &WREFX
      IF EOF()
         IF WTIPODOC <> "PRE"
            STORE "ERROR, DESAPARECIO EL DOCUMENTO A PROCESAR No."+WREFX TO MES
            DO AVISO WITH MES
         ENDIF
      ELSE
         *** REVERSANDO REFERENCIA
         SELECT 6
         FIND &WREFX
         DO WHILE .NOT. EOF() .AND. NUMERO = WREFX
            IF PROCESADO = WNUMERO2
               REPLACE PROCESADO WITH SPACE(23)
            ENDIF
            SKIP
         ENDDO
         *** FIN REVERSANDO REFERENCIA

         *** MARCANDO COMO PROC. LOS RENG. DE LA REF. QUE ESTEN EN EL DOC.
         SELECT 6
         FIND &WNUMERO2
         DO WHILE .NOT. EOF() .AND. NUMERO = WNUMERO2
            STORE RECNO() TO WRECDOC
            STORE WREFX+RENGLON TO WCLAVEREF
            FIND &WCLAVEREF
            IF EOF()
               STORE "ADVERTENCIA: RENGLON A PROCESAR EN DOC. REFERENCIAL NO EXISTE." TO MES
               DO AVISO WITH MES
               STORE "REFERENCIA = "+WREFX+" RENGLON = "+RENGLON TO MES
               DO AVISO WITH MES
            ELSE
               REPLACE PROCESADO WITH WNUMERO2
            ENDIF
            GO WRECDOC
            SKIP
         ENDDO
      ENDIF
   ENDIF
ENDIF
RETURN


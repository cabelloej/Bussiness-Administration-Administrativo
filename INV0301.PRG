
***
* ON ERROR DO ERRCON
*STORE SPACE(40) TO QQWW
*STORE "CONSTRUCTORA LA ESTANCIA DORADA, C.A.   " TO T3
*STORE 0 TO PPP
*DO INFORMA
*if qqww<>t3
*    store 1 to ppp
*endif
*if ppp = 1
*   store "ERROR DE INSTALACION" to mes
*   do aviso with mes
*   close all
*   quit
*endif
***
IF FLAGASK
   SELECT 2
   REPLACE ALL FLAGREPRO WITH "S"
ENDIF
STORE "REPROCESANDO MOVIMIENTOS DE LOS ARTICULOS AFECTADOS. FAVOR ESPERAR..." TO MES
DO MENSAJE WITH MES
SELECT 2
GO TOP
LOCATE FOR FLAGREPRO = "S"
DO WHILE .NOT. EOF()
   STORE UNIAPE TO WUNIEXI
   STORE COSAPE TO WCOSEXI
   STORE CODIGO TO WCODIGO
   SELECT 3
   SET INDEX TO INVTRA1,INVTRA2,INVTRA3
   FIND &WCODIGO
   DO WHILE .NOT. EOF() .AND. CODIGO = WCODIGO
           STORE UNIDADES TO WUNIDADES
           STORE COSTO TO WCOSTO
      DO CASE
      CASE OPERACION = "EN"
           STORE ((WCOSEXI*WUNIEXI)+(WCOSTO)) / (WUNIEXI+WUNIDADES) TO WCOSEXI
           STORE WUNIEXI + WUNIDADES TO WUNIEXI
      CASE OPERACION = "SA"
           STORE  WUNIEXI - WUNIDADES TO WUNIEXI
           REPLACE COSTO WITH WCOSEXI*WUNIDADES
      CASE OPERACION = "AE"
           STORE WUNIEXI + WUNIDADES TO WUNIEXI
           REPLACE COSTO WITH WCOSEXI*WUNIDADES
      CASE OPERACION = "AS"
           STORE WUNIEXI - WUNIDADES TO WUNIEXI
           REPLACE COSTO WITH WCOSEXI*WUNIDADES
      CASE OPERACION = "AC"
           STORE  ((WCOSEXI*WUNIEXI)+WCOSTO) / WUNIEXI   TO WCOSEXI
      ENDCASE
      SKIP
   ENDDO
   SELECT 2
   REPLACE FLAGREPRO WITH SPACE(1)
   REPLACE UNIEXI WITH WUNIEXI
   REPLACE COSEXI WITH WCOSEXI
   CONTINUE
ENDDO


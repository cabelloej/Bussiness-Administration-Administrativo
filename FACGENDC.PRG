store .f. to wflaggen
STORE .F. TO WFLAGCLI
IF WTIPODOC = "FAC"
   STORE "NOT" TO WREF
   STORE "NOTA DE ENTREGA" TO WREFDES
ELSE
   IF WTIPODOC = "NOT"
      STORE "ORD" TO WREF
      STORE "ORDEN DE COMPRA" TO WREFDES
      STORE .T. TO WFLAGCLI
   ELSE
      IF WTIPODOC = "ORD"
         STORE "PRE" TO WREF
         STORE "PRESUPUESTO" TO WREFDES
      ELSE
         STORE STR(WLISTA,1) TO WLISTA
         RETURN
      ENDIF
   ENDIF
ENDIF

STORE "REFERENCIA. "+WREFDES+" No.:" TO MES
DO MENSAJE WITH MES
IF WTIPODOC <> "NOT"
   STORE SPACE(20) TO WNUMREF
   @ 23,58 GET WNUMREF PICTURE "#######"
   READ
ELSE
   STORE SPACE(20) TO WNUMREF
   @ 23,58 GET WNUMREF
   READ
ENDIF
STORE WREF+WNUMREF TO WCLAVEREF
SELECT 5
STORE RECNO() TO WREGDOC
FIND &WCLAVEREF
IF EOF()
   STORE WREFDES+" No."+WNUMREF+" NO EXISTE. <ENTER>" TO MES
   DO AVISO WITH MES
   STORE STR(WLISTA,1) TO WLISTA
   RETURN
ENDIF
*** VERIFICAR SI LOS RENG. DE LA REF. NO ESTAN PROCESADOS
SELECT 6
STORE 0 TO WTOTREG
STORE 0 TO WTOTPRO
FIND &WCLAVEREF
DO WHILE .NOT. EOF() .AND. NUMERO = WCLAVEREF
   STORE RECNO()  TO WRECDE
   STORE WTOTREG + 1 TO WTOTREG
   STORE .F. TO WFLAGP
   IF PROCESADO = SPACE(23)
      STORE RENGLON   TO WREN
      STORE ITEM      TO WITE
      STORE CANTIDAD  TO WCAN
      STORE PRECIO    TO WPRE
      STORE DESCUENTO TO WDES
      APPEND BLANK
      REPLACE NUMERO    WITH WNUMERO2
      REPLACE RENGLON   WITH WREN
      REPLACE ITEM WITH WITE
      REPLACE CANTIDAD  WITH WCAN
      REPLACE PRECIO    WITH WPRE
      REPLACE DESCUENTO WITH WDES
      STORE .T. TO WFLAGP
      STORE WTOTPRO + 1 TO WTOTPRO
   ELSE
      STORE "RENGLON:"+RENGLON+" , YA ESTA PROCESADO CON :"+PROCESADO TO MES
      DO AVISO WITH MES
   ENDIF
   GO WRECDE
   IF WFLAGP
      REPLACE PROCESADO WITH WNUMERO2
   ENDIF
   SKIP
ENDDO
STORE "TOTAL RENGLONES EN REFERENC.:"+STR(WTOTREG,4)+" TOTAL TRANSFERIDOS:"+STR(WTOTPRO,4) TO MES
DO AVISO WITH MES
SELECT 5
IF WTOTPRO > 0
   STORE RECNO()   TO WRECREF
   STORE SPACE(20) TO WREF
   STORE CLIENTE   TO WCLIENTE
   STORE VENDEDOR  TO WVENDEDOR
   STORE COMVEN    TO WCOMISION
   STORE WFECACT   TO WELABORADO
   STORE LISTA     TO WLISTA
   STORE MONTO     TO WMONTO
   STORE REFCLI    TO WREFCLI
   store .t. to wflaggen
   APPEND BLANK
   REPLACE NUMERO     WITH WNUMERO2
   REPLACE REFERENCIA WITH WCLAVEREF
   IF WFLAGCLI
      REPLACE REFCLI  WITH WCLAVEREF
   ELSE
      REPLACE REFCLI  WITH WREFCLI
   ENDIF
   REPLACE CLIENTE    WITH WCLIENTE
   REPLACE VENDEDOR   WITH WVENDEDOR
   REPLACE COMVEN     WITH WCOMISION
   REPLACE ELABORADO  WITH WELABORADO
   REPLACE LISTA      WITH WLISTA
   REPLACE MONTO      WITH WMONTO
ENDIF
SELECT 5
GO WREGDOC
RETURN


SELECT 4
SAVE SCRE TO S4
STORE 100 TO LINE
STORE WUNIDADES TO WRESUMEN
DO WHILE WRESUMEN > 0
   IF LINE > 20
      SET COLOR TO G+/N
      @ 4,58 CLEAR TO 21,79
      @ 7,58 TO 21,79
      @ 6,61 SAY "CONTROL DE LOTES"
      @ 8,59 SAY "LOTE       UNIDADES"
      STORE 9 TO LINE
   ENDIF
   STORE SPACE(10) TO WLOTE
   store "INGRESE EL CODIGO DE LOTE DEL ARTICULO "+WCODIGO TO MES
   DO MENSAJE WITH MES
   @ LINE,59 GET WLOTE
   READ
   IF WLOTE = SPACE(10)
      IF WRESUMEN <> 0
         STORE "LA ASIGNACION DE LOTES NO CUADRA CON LAS UNIDADES DE LA OPERACION" TO MES
         DO AVISO WITH MES
         LOOP
      ELSE
         RESTORE SCRE FROM S4
         RETURN
      ENDIF
   ENDIF
   STORE WRESUMEN TO WUNID
   @ LINE,70 GET WUNID PICTURE "######.##"
   READ
   STORE WCODIGO+WLOTE TO WCLAVE

   IF WOPE = "EN" .OR. WOPE = "AE"
      FIND &WCLAVE
      IF EOF()
         APPEND BLANK
         REPLACE CODART WITH WCODIGO
         REPLACE CODLOT WITH WLOTE
         REPLACE FECHAING WITH WFECHAOP
      ENDIF
      REPLACE UNIDADES WITH UNIDADES+WUNID
      STORE WRESUMEN - WUNID TO WRESUMEN
      SELECT 8
      APPEND BLANK
      REPLACE CODART WITH WCODIGO
      REPLACE CODLOT WITH WLOTE
      REPLACE OPERACION WITH "EN"
      REPLACE UNIDADES WITH WUNID
      REPLACE REFERENCIA WITH WRESPALDO
      SELECT 4
      FLUSH
      STORE LINE+1 TO LINE
      LOOP
   ENDIF
   IF WOPE = "SA" .OR. WOPE = "AS"
      FIND &WCLAVE
      IF EOF()
         SAVE SCRE TO S5
         STORE "CODIGO DE LOTE NO REGISTRADO" TO MES
         DO AVISO WITH MES
         STORE LINE TO WSAFE
         DO INV0104
         RESTORE SCRE FROM S5
         STORE WSAFE TO LINE
         LOOP
      ENDIF
      IF WUNID>UNIDADES
         STORE "ADVERTENCIA: ESTA DESCONTANDO MAS UNIDADES DE LAS QUE QUEDAN EN EL LOTE" TO MES
         DO AVISO WITH MES
      ENDIF
      REPLACE UNIDADES WITH UNIDADES-WUNID
      STORE WRESUMEN - WUNID TO WRESUMEN
      SELECT 8
      APPEND BLANK
      REPLACE CODART WITH WCODIGO
      REPLACE CODLOT WITH WLOTE
      REPLACE OPERACION WITH "SA"
      REPLACE UNIDADES WITH WUNID
      REPLACE REFERENCIA WITH WRESPALDO
      SELECT 4
      FLUSH
      STORE LINE+1 TO LINE
   ENDIF
ENDDO
RETURN


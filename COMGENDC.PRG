store .f. to wflaggen
STORE RECNO() TO WREGDOC
IF WTIPODOC = "NOT"
   STORE "ORD" TO WREF
   STORE "ORDEN DE COMPRA" TO WREFDES
ELSE
   RETURN
ENDIF

STORE "REFERENCIA DEL DOCUMENTO, "+WREFDES+" No.:" TO MES
DO MENSAJE WITH MES
STORE SPACE(7) TO WNUMREF
@ 23,65 GET WNUMREF PICTURE "#######"
READ
STORE WREF+WNUMREF TO WCLAVEREF
SELECT 5
FIND &WCLAVEREF
IF EOF()
   STORE WREFDES+" No."+WNUMREF+" NO EXISTE. <ENTER>" TO MES
   DO AVISO WITH MES
   RETURN
ENDIF
*** MARCAR REGISTRO COMO PROCESADO
IF PROCESADO = "S"
   STORE WREFDES+" No."+WNUMREF+" YA FUE PROCESADA. <ENTER> PARA SALIR" TO MES
   DO AVISO WITH MES
   CLOSE DATA
   CLOSE INDEX
   USE SYSDATE
   REPLACE FALLAFAC WITH 0
   USE
   RETURN TO MASTER
ENDIF
REPLACE PROCESADO WITH "S"

STORE RECNO()   TO WRECREF
STORE SPACE(10) TO WREF
STORE CLIENTE   TO WCLIENTE
STORE WFECACT   TO WELABORADO
STORE MONTO     TO WMONTO

store .t. to wflaggen
APPEND BLANK
REPLACE NUMERO     WITH WNUMERO2
REPLACE REFERENCIA WITH WCLAVEREF
REPLACE CLIENTE    WITH WCLIENTE
REPLACE ELABORADO  WITH WELABORADO
REPLACE MONTO      WITH WMONTO

SELECT 6
COPY STRU TO COMTEMP1
SELECT 10
*** PARA CONVERSION A MULTIUSUARIO EL FACTEMP1 DEBE TENER NOMBRE VARIABLE (USER)
USE COMTEMP1
SELECT 6
FIND &WCLAVEREF
DO WHILE .NOT. EOF() .AND. NUMERO = WCLAVEREF
   STORE RENGLON   TO WREN
   STORE ITEM      TO WITE
   STORE CANTIDAD  TO WCAN
   STORE PRECIO    TO WPRE
   STORE DESCUENTO TO WDES
   SELECT 10
   APPEND BLANK
   REPLACE NUMERO    WITH WNUMERO2
   REPLACE RENGLON   WITH WREN
   REPLACE ITEM WITH WITE
   REPLACE CANTIDAD  WITH WCAN
   REPLACE PRECIO    WITH WPRE
   REPLACE DESCUENTO WITH WDES
   SELECT 6
  SKIP
ENDDO
SELECT 10
USE
SELECT 6
APPEND FROM COMTEMP1
DELETE FILE COMTEMP1
SELECT 5
GO WREGDOC
RETURN



***
* ON ERROR DO ERRCON
*STORE SPACE(40) TO QQWW
*STORE "CONSTRUCTORA LA ESTANCIA DORADA, C.A.   " TO T3
*STORE 0 TO PPP
*DO INFORMA
*if qqww<>t3
*    store 1 to ppp
*endif
*if ppp = 1
*   store "ERROR DE INSTALACION" to mes
*   do aviso with mes
*   close all
*   quit
*endif
***
STORE SPACE(3) TO WLINEA
STORE SPACE(1) TO WULTCOS
STORE 0 TO WFACTOR
@ 11,54 CLEAR TO 18,77
@ 11,54 TO 18,77
@ 12,55  SAY "LINEA DE VENTA:" GET WLINEA
@ 13,55  SAY "ULT.COSTO(S/N):"
@ 14,55  SAY "FACTOR (xCOST):" 
READ
IF WLINEA = SPACE(3)
   @ 12,70 SAY "TODAS"
ELSE
   SELECT 1
   FIND &WLINEA
   IF EOF()
      STORE "LINEA DE VENTA NO REGISTRADA. <ENTER>" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF
ENDIF
STORE .T. TO VERCOS
DO WHILE VERCOS
   STORE SPACE(1) TO WULTCOS
   @ 13,70 GET WULTCOS
   READ
   STORE UPPER(WULTCOS) TO WULTCOS
   IF WULTCOS = "S" .OR. WULTCOS = "N"
      STORE .F. TO VERCOS
      LOOP
   ENDIF
ENDDO
IF WULTCOS = "N"
   @ 14,70 GET WFACTOR PICTURE "##.##" RANGE 0.1, 99.99
   READ
   IF WFACTOR = 0 .OR. READKEY() = 12 .OR. READKEY() = 268
      RETURN
   ENDIF
ENDIF
IF READKEY() = 12 .OR. READKEY() = 268
   RETURN
ENDIF
STORE "CONFORME ? (S/N)" TO TEX
STORE "NS" TO WCH
DO PREGUNTA
IF WCH = "N"
   RETURN
ENDIF
STORE "RECOSTEANDO ARTICULOS SELECCIONADOS. FAVOR ESPERAR..." TO MES
DO MENSAJE WITH MES

SELECT 2
DO WHILE .NOT. EOF()
   IF WLINEA <> SPACE(3) .AND. WLINEA <> LINEA
      SKIP
      LOOP
   ENDIF
   STORE CODIGO TO WCODIGO
   STORE WFECACT TO WFECHAOP
   STORE "AC" TO WOPE
   STORE "RECOSTEO" TO WNUMERO
   STORE "INV" TO WORIGEN
   STORE 0 TO WUNIDADES
   STORE 0 TO WTOTAL
   STORE COSEXI TO WULCOEX
   IF WULTCOS = "S"
      IF ULTCOSTO > 0
         REPLACE COSEXI WITH ULTCOSTO
      ELSE
         SELECT 2
         SKIP
         LOOP
      ENDIF
   ELSE
      REPLACE COSEXI WITH COSEXI*WFACTOR
   ENDIF
   STORE COSEXI-WULCOEX TO WVARCOS
   STORE WVARCOS * UNIEXI TO WCOSTO

   SELECT 3
   APPEND BLANK
   REPLACE SERIAL WITH SYSDATE->SERIAL+1
   replace codigo with wcodigo
   replace fecha with wfechaop
   replace operacion with wope
   replace referencia with wnumero
   replace origen with WORIGEN
   REPLACE UNIDADES WITH WUNIDADES
   REPLACE COSTO WITH WCOSTO
   FLUSH
   SELECT 9
   REPLACE SERIAL WITH SERIAL+1
   FLUSH
   SELECT 2
   SKIP
ENDDO
RETURN

